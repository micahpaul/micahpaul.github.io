<html>
<header>
<title>Memify This!</title>
<script type="text/javascript">


    window.onload=function(){
      
// Padding variable
var padding = 20;

// Define body variable - for appending
var body = document.getElementsByTagName("body")[0];

// Create Canvas
var canvas = document.createElement("canvas");
body.appendChild(canvas);

// Set the font size -- Impact is quite memey
function setFontSize(ctx, fontsize) {
  ctx.font = "bolder " + fontsize + "px Impact,Futura,sans-serif";
}

// Here's some funny logics about how to draw the text
function drawText(ctx, img, memetext, top, imgadj) {
  memetext = memetext.toUpperCase();
  var fontsize = ( img.width / 6 ) * imgadj;
  var textwidth = img.width * imgadj;
  setFontSize(ctx, fontsize);

  while (textwidth + padding > ( img.width * imgadj ) ) {
    fontsize *= .9;
    setFontSize(ctx, fontsize);
    textwidth = ctx.measureText(memetext).width;
  }

  var xpos = ( ( img.width * imgadj ) - textwidth) / 2;
  var ypos = ( img.height * imgadj ) - (padding / 2);
  
  if( top ) {
  	ypos = fontsize;
  }
  
  ctx.lineWidth = fontsize / 30;
  ctx.fillText(memetext, xpos, ypos);
  ctx.strokeText(memetext, xpos, ypos);
}

// Here's a function to draw the image and meme text...
function drawTheMeme(imgUrl, topText, bottomText, resultWidth) {
  var img = new Image();
  img.onload = function() {
    var imgadj = resultWidth / img.width;
    var wadj  = img.width * imgadj;
    var hadj  = img.height * imgadj;
    canvas.width = wadj;
    canvas.height = hadj;
    var ctx = canvas.getContext('2d');
    ctx.strokeStyle = "black";
    ctx.fillStyle = "white";
    ctx.drawImage(img, 0, 0, wadj, hadj );
    drawText(ctx, img, topText, true, imgadj);
    drawText(ctx, img, bottomText, false, imgadj);
  }
  img.src = imgUrl;
}

// Create URL Text Input
body.appendChild(document.createElement("p"));
body.appendChild(document.createTextNode('URL: '));
var urlTextBox = document.createElement("input");
urlTextBox.type = "text";
urlTextBox.size = 80;
urlTextBox.value = "https://cdn1.thr.com/sites/default/files/imagecache/landscape_928x523/2011/11/elmo_a.jpg"
body.appendChild(urlTextBox);

// Create Upper Meme Text Input
body.appendChild(document.createElement("p"));
body.appendChild(document.createTextNode('Top Text:'));
var upperMemeTextBox = document.createElement("input");
upperMemeTextBox.type = "text";
upperMemeTextBox.size = 50;
upperMemeTextBox.value = "";
body.appendChild(upperMemeTextBox);

// Create Lower Meme Text Input
body.appendChild(document.createElement("p"));
body.appendChild(document.createTextNode('Bottom Text:'));
var lowerMemeTextBox = document.createElement("input");
lowerMemeTextBox.type = "text";
lowerMemeTextBox.size = 50;
lowerMemeTextBox.value = "you fill elmo with sadness"
body.appendChild(lowerMemeTextBox);
        
// Create Image Width Input
body.appendChild(document.createElement("p"));
body.appendChild(document.createTextNode('Result Width:'));
var widthNumberBox = document.createElement("input");
widthNumberBox.type = "number";
widthNumberBox.size = 50;
widthNumberBox.value = 600;
body.appendChild(widthNumberBox);

// Create button
body.appendChild(document.createElement("p"));
var button = document.createElement("button");
button.innerHTML = "Memify!";
button.addEventListener ("click", doAction);
body.appendChild(button);

function doAction() {
  drawTheMeme(urlTextBox.value, upperMemeTextBox.value, lowerMemeTextBox.value, widthNumberBox.value);
}

doAction();

    }

</script>
</header>
<body>
</body>
</html>
