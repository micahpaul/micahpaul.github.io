<html>
<header>
<title>Memify This!</title>
    
<style>
td {
        font-family: Impact,HelveticaNeue-CondensedBlack,sans-serif;
        font-size: 12px;
    }
</style>
    
<script type="text/javascript">


    window.onload=function(){
      
// Padding variable
var padding = 20;

// Define body variable - for appending
var body = document.getElementsByTagName("body")[0];

// Create Canvas
var canvas = document.createElement("canvas");
body.appendChild(canvas);

// Set the font size -- Impact is quite memey
function setFontSize(ctx, fontsize) {
  ctx.font = "bolder " + fontsize + "px Impact,HelveticaNeue-CondensedBlack,sans-serif";
}

// Here's some funny logics about how to draw the text
function drawText(ctx, img, memetext, top, imgadj, upperCase) {
  if ( upperCase ) {
      memetext = memetext.toUpperCase();
  }
  var fontsize = ( img.width / 6 ) * imgadj;
  var textwidth = img.width * imgadj;
  setFontSize(ctx, fontsize);

  while (textwidth + padding > ( img.width * imgadj ) ) {
    fontsize *= .9;
    setFontSize(ctx, fontsize);
    textwidth = ctx.measureText(memetext).width;
  }

  var xpos = ( ( img.width * imgadj ) - textwidth) / 2;
  var ypos = ( img.height * imgadj ) - (padding / 2);
  
  if( top ) {
  	ypos = fontsize;
  }
  
  ctx.lineWidth = fontsize / 30;
  ctx.fillText(memetext, xpos, ypos);
  ctx.strokeText(memetext, xpos, ypos);
}

// Here's a function to draw the image and meme text...
function drawTheMeme(imgUrl, topText, bottomText, resultWidth, upperCase) {
  var img = new Image();
  img.onload = function() {
    var imgadj = resultWidth / img.width;
    var wadj  = img.width * imgadj;
    var hadj  = img.height * imgadj;
    canvas.width = wadj;
    canvas.height = hadj;
    var ctx = canvas.getContext('2d');
    ctx.strokeStyle = "black";
    ctx.fillStyle = "white";
    ctx.drawImage(img, 0, 0, wadj, hadj );
    drawText(ctx, img, topText, true, imgadj, upperCase);
    drawText(ctx, img, bottomText, false, imgadj, upperCase);
  }
  img.src = imgUrl;
}
        
//Add a new row with a title and an element
function addRow(table, title, element) {
    var tmpRow = table.appendChild(document.createElement("tr"));
    tmpRow.appendChild(document.createElement("td"))
          .appendChild(document.createTextNode(title + ":"));
    tmpRow.appendChild(document.createElement("td"))
          .appendChild(element);  
}

// Create URL Text Input
var urlTextBox = document.createElement("input");
urlTextBox.type = "text";
urlTextBox.size = 80;
urlTextBox.value = "http://www.jesuschristsavior.net/Savior.jpeg"
        
// Create Upper Meme Text Input
var upperMemeTextBox = document.createElement("input");
upperMemeTextBox.type = "text";
upperMemeTextBox.size = 80;
upperMemeTextBox.value = "bro";

// Create Lower Meme Text Input
var lowerMemeTextBox = document.createElement("input");
lowerMemeTextBox.type = "text";
lowerMemeTextBox.size = 80;
lowerMemeTextBox.value = "believe me"

// Create Image Width Input
var widthNumberBox = document.createElement("input");
widthNumberBox.type = "number";
widthNumberBox.size = 80;
widthNumberBox.value = 450;
        
// Create Image Width Input
var upperCaseCheckBox = document.createElement("input");
upperCaseCheckBox.type = "checkbox";
upperCaseCheckBox.checked = true;

var inputTable = body.appendChild(document.createElement("table"));
addRow( inputTable, "URL", urlTextBox );
addRow( inputTable, "Upper Text",   upperMemeTextBox    );
addRow( inputTable, "Lower Text",   lowerMemeTextBox    );
addRow( inputTable, "Result Width", widthNumberBox      );
addRow( inputTable, "UPPERCASE",    upperCaseCheckBox   );

// Create button
body.appendChild(document.createElement("p"));
var button = document.createElement("button");
button.innerHTML = "Memify!";
button.addEventListener ("click", doAction);
body.appendChild(button);

function doAction() {
  drawTheMeme(urlTextBox.value, upperMemeTextBox.value, lowerMemeTextBox.value, widthNumberBox.value, upperCaseCheckBox.checked);
}

doAction();

    }

</script>
</header>
<body>
</body>
</html>
